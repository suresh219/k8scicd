kind: pipeline
name: default
steps:
- name: test
  image: golang:1.10-alpine
  commands:
    - "go test"
- name: build
  image: golang:1.10-alpine
  commands:
    - "go build -o ./myapp"
- name: publish
  image: plugins/docker
  settings:
    repo: magalixcorp/k8scicd
    tags: [ "${DRONE_COMMIT_SHA:0:7}","latest" ]
    username:
      from_secret: docker_username
    password:
      from_secret: docker_password
  
- name: deliver
  # image: plugins/ansible:1
  image: openshift/origin-ansible
  environment:
    K8S_AUTH_KUBECONFIG: 
      from_secret: K8S_AUTH_KUBECONFIG
    PLAYBOOK_FILE: /.ansible/playbook.yml
    INVENTORY_FILE: /.ansible/inventory
  volumes:
  - ".ansible:/.ansible"
  